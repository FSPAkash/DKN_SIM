providers = []

[phases.setup]
nixPkgs = ["python311", "nodejs-18_x"]

[phases.install]
dependsOn = ["setup"]
cmds = [
    "python3 -m venv /app/venv",
    "/app/venv/bin/pip install --upgrade pip",
    "/app/venv/bin/pip install -r backend/requirements.txt",
    "cd frontend && npm install --legacy-peer-deps"
]

[phases.build]
dependsOn = ["install"]
cmds = ["cd frontend && npx --yes vite build"]

[start]
cmd = "/app/venv/bin/gunicorn --chdir backend wsgi:app --bind 0.0.0.0:$PORT --workers 2"

[variables]
PYTHONUNBUFFERED = "1"
NODE_ENV = "production"
npm_config_cache = "/app/.npm-cache"